%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                DO NOT CONVERT TABS TO SPACES IN THIS FILE                %%
%%                DO NOT CONVERT TABS TO SPACES IN THIS FILE                %%
%%                DO NOT CONVERT TABS TO SPACES IN THIS FILE                %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Vim settings                                                             %%
%%    set noexpandtab tw=0 indentexpr=                                      %%
%%    set spelllang=en spellfile=SmokeyManual.en.utf-8.add                  %%
%%    set spell                                                             %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% TODO:
%%   - Consider putting things in {figure} and and {table} environments so
%%     that TeX can reflow them better
%%   - Reconsider the bullets when nesting {Property} {Definition} {itemize}
%%   - Create a better \NameRef that uses numbers for sections/subsections
%%     but titles for subsubsections
%%   - Replace \ComputerMouse with a bear symbol (CA state flag style)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[11pt]{article}

\newcommand{\newlengthval}[2]{%
	\newlength{#1}%
	\setlength{#1}{#2}%
}

% Body text (only) is indented by a small amount
\newlengthval{\BodyIndentLeft}{0.75in}
\newlengthval{\TransverseMargin}{1in}
\newlengthval{\TopMargin}{1.125in}
\newlengthval{\BottomMargin}{1in}

\usepackage[letterpaper]{geometry}
\newlengthval{\LeftMargin}{\TransverseMargin}
\addtolength{\LeftMargin}{\BodyIndentLeft}
\geometry{top=\TopMargin, bottom=\BottomMargin, left=\LeftMargin, right=\TransverseMargin}

\usepackage{fontspec}
\setmainfont%
	[%
		% Fix en- and em-dashes
		Ligatures=TeX,%
		% Myriad Set is Apple's official font
		% http://istweb.apple.com/software/apps/myriad_set/
		BoldFont=MyriadSetBold.ttf,%
		ItalicFont=MyriadSetTextItalic.ttf,%
		BoldItalicFont=MyriadSetBoldItalic.ttf%
	]%
	{MyriadSetText.ttf}
% Menlo has bold and italic variants
\setmonofont[Scale=MatchLowercase]{Menlo}
% Unicode symbols
\newcommand{\LeftArrowHook}{\char"21A9}
\newcommand{\RightArrowHook}{\char"21AA}
\newcommand{\AppleLogo}{\char"F8FF}
% Other symbols
\usepackage{marvosym}
\usepackage{ifsym}
\newcommand{\Campfire}{\textifsymbol{12}}
\newfontfamily{\WingdingsFamily}{Wingdings.ttf}
\newcommand{\FloppySym}{{\WingdingsFamily\symbol{60}}}
\newcommand{\ClosedFolderSym}{{\WingdingsFamily\symbol{48}}}
\newcommand{\OpenFolderSym}{{\WingdingsFamily\symbol{49}}}
\newfontfamily{\KeyCapsFamily}{Mac Key Caps.ttf}
\newcommand{\KeyCapsCtrlD}{{\KeyCapsFamily DPd}}
\newcommand{\KeyCapsCtrlC}{{\KeyCapsFamily DPc}}
\newcommand{\KeyCapsEnter}{{\KeyCapsFamily R}}

\usepackage[table]{xcolor}
% http://web.apple.com/areas/marketing/corpid/docs/Apple_Type_Guidelines_112213.pdf
% Pantone 429, CMYK 0/0/0/40, RGB 171/175/180
\definecolor{AppleGray}{RGB}{171,175,180}
\definecolor{SmokeyDarkBlue}{RGB}{0,100,185}
\definecolor{SmokeyBlue}{RGB}{28,122,193}
\definecolor{SmokeyLightBlue}{RGB}{212,223,238}

\usepackage{titlesec}
% Sections create new pages
\newcommand{\sectionbreak}{\clearpage}
% Enlarge \subsection and \subsubsection text
% Put \section and \subsection at the same indentation
% Indent \subsubsection from \subsection inwards by \BodyIndentLeft
% Outdent everything by \BodyIndentLeft
\newlength{\TitleWidth}
\newcommand{\Outdented}[1]{\settowidth{\TitleWidth}{#1}\hspace{-\TitleWidth}#1}
\newlengthval{\SectionNumberSep}{0.25in}
% Use \textcolor instead of \color because the latter allows LaTeX to
% introduce a page break immediately after the title
\titleformat{\section}%
	{\bf\Huge}%
	{\Outdented{\textcolor{SmokeyDarkBlue}{\thesection}\hspace{\SectionNumberSep}}}%
	{0in}%
	{\textcolor{SmokeyDarkBlue}}
\titleformat{\subsection}%
	{\bf\Large}%
	{\Outdented{\textcolor{SmokeyDarkBlue}{\thesubsection}\hspace{\SectionNumberSep}}}%
	{0in}%
	{\textcolor{SmokeyDarkBlue}}
\titleformat{\subsubsection}%
	{\bf\large}%
	{}%
	{0in}%
	{\textcolor{SmokeyDarkBlue}}
\titlespacing{\subsubsection}%
	{0in}%
	{\parskip}%
	{0in}
% 1.2x line spacing
%\linespread{1.2}

\usepackage{fancyhdr}
% Notice on left; Page number on right
% Need \mbox to fix vertical alignment between logo and page number
\lhead{\mbox{\color{AppleGray}\AppleLogo} Apple Confidential --- Internal Use Only}
\chead{}
\rhead{\thepage}
%\renewcommand{\headrulewidth}{0in}
% No footer
\lfoot{}
\cfoot{}
\rfoot{}
%\renewcommand{\footrulewidth}{1pt}
% Suppress warning about \headheight being too small
\setlength{\headheight}{1.5\baselineskip}
\pagestyle{fancy}

\usepackage[hang,flushmargin,bottom]{footmisc}
%\renewcommand{\footnoterule}{}

% Block paragraph format
\usepackage{parskip}

\usepackage{hyperref}
\newcommand{\NumNameRef}[1]{\ref{#1}\,\textit{\nameref{#1}}}
\newcommand{\NameRef}[1]{\textit{\nameref{#1}}}

\usepackage{tikz}
\usetikzlibrary{decorations}
\usetikzlibrary{trees}

\pgfdeclaredecoration{complete sines}{initial}{
	\state{initial}
		[
			width=+0pt,
			next state=sine,
			persistent precomputation={
				\pgfmathsetmacro\matchinglength{
					\pgfdecoratedinputsegmentlength / int(\pgfdecoratedinputsegmentlength/\pgfdecorationsegmentlength)
				}
				\setlength{\pgfdecorationsegmentlength}{\matchinglength pt}
			}
		]
		{}
	\state{sine}[width=\pgfdecorationsegmentlength]{
		\pgfpathsine{\pgfpoint{0.25\pgfdecorationsegmentlength}{0.5\pgfdecorationsegmentamplitude}}
		\pgfpathcosine{\pgfpoint{0.25\pgfdecorationsegmentlength}{-0.5\pgfdecorationsegmentamplitude}}
		\pgfpathsine{\pgfpoint{0.25\pgfdecorationsegmentlength}{-0.5\pgfdecorationsegmentamplitude}}
		\pgfpathcosine{\pgfpoint{0.25\pgfdecorationsegmentlength}{0.5\pgfdecorationsegmentamplitude}}
	}
	\state{final}{}
}

% http://tex.stackexchange.com/questions/89129/changing-the-indentation-of-a-tikz-tree
\newcommand{\SmokeyTreeIndent}{\leftmargini}
\newcommand{\SmokeyTreeSkip}{\baselineskip}
\makeatletter
\newcount\dirtree@lvl
\newcount\dirtree@plvl
\newcount\dirtree@clvl
\def\dirtree@growth{%
	\ifnum\tikznumberofcurrentchild=1\relax%
		\global\advance\dirtree@plvl by 1\relax%
		\expandafter\xdef\csname dirtree@p@\the\dirtree@plvl\endcsname{\the\dirtree@lvl}%
	\fi%
	\global\advance\dirtree@lvl by 1\relax%
	\dirtree@clvl=\dirtree@lvl%
	\advance\dirtree@clvl by -\csname dirtree@p@\the\dirtree@plvl\endcsname%
	\pgf@xa=\SmokeyTreeIndent\relax%
	\pgf@ya=-\SmokeyTreeSkip\relax%
	\pgf@ya=\dirtree@clvl\pgf@ya%
	\pgftransformshift{\pgfqpoint{\the\pgf@xa}{\the\pgf@ya}}%
	\ifnum\tikznumberofcurrentchild=\tikznumberofchildren%
		\global\advance\dirtree@plvl by -1\relax%
	\fi%
}
\tikzset{%
	dirtree/.style={%
		growth function=\dirtree@growth,%
		growth parent anchor=south west,%
		parent anchor=south west,%
		every node/.style={%
			%anchor=north,%
			% Need to set minimum height, inner/outer sep, and
			% text depth in order to make each node drawn the
			% same height regardless of ascenders and descenders
			% in the font
			minimum height=\baselineskip,%
			inner sep=0in,%
			outer ysep=0in,%
			outer xsep=1ex,%
			text depth=0.2ex%
		},%
		every child node/.style={%
			anchor=south west%
		},%
		edge from parent path={%
			([xshift=2ex] \tikzparentnode\tikzparentanchor)%
			|- (\tikzchildnode\tikzchildanchor)%
		}%
	}%
}
\makeatother

\newcommand{\SquareTextBullet}{\rule[0.3ex]{0.75ex}{0.75ex}}

% Documentation: http://mirrors.ibiblio.org/CTAN/macros/latex/contrib/enumitem/enumitem.pdf
\usepackage{enumitem}

% Diagram of the various dimensions for lists: http://www.ntg.nl/maps/11/33.pdf
%\setlist{parsep=0.1\baselineskip, itemsep=0.2\baselineskip}
\newlengthval{\StandardLabelSep}{0.5em}
\setlist{labelsep=\StandardLabelSep}

\newcommand{\ProcessLabelFormat}[1]{#1.}
\newlist{Process}{enumerate}{3}
\setlist[Process,1]{%
	label=\ProcessLabelFormat{\arabic*},%
	}
\setlist[Process,2]{label=\ProcessLabelFormat{\alph*}}
\setlist[Process,3]{label=\ProcessLabelFormat{\roman*}}

\newcommand{\ItemizeBulletFormat}[1]{#1}
\setlist[itemize,1]{label=\ItemizeBulletFormat{\textbullet}}
\setlist[itemize,2]{label=\ItemizeBulletFormat{--}}

\newlist{Definition}{description}{3}
\newcommand{\DefinitionBulletFormat}[1]{#1}
\newcommand{\DefinitionFormat}[1]{%
	\makebox[0in][r]{\DefinitionBulletFormat{\textbullet}\hspace{\StandardLabelSep}}%
	#1\textnormal{ --- }%
}
\setlist[Definition]{%
	leftmargin=\leftmargini,%
	labelsep=0in,%
	labelindent=\leftmargin,%
	style=standard,%
	format=\DefinitionFormat%
}

\newlist{Property}{description}{1}
\newcommand{\PropertyBulletFormat}[1]{{\color{SmokeyBlue}#1}}
\newcommand{\PropertyFormat}[1]{%
	\makebox[0in][r]{\PropertyBulletFormat{\SquareTextBullet}\hspace{\StandardLabelSep}}%
	#1\textnormal{ --- }%
}
\setlist[Property]{%
	leftmargin=0in,%
	labelsep=0in,%
	labelindent=\leftmargin,%
	style=standard,%
	format=\PropertyFormat%
}

\newcounter{LogSectioni}
\newcommand{\LogSectionBulletFormat}[1]{\textnormal{#1}}
\newcommand{\LogSectionFormat}[1]{%
	\stepcounter{LogSectioni}%
	\hspace{\leftmargini}%
	\makebox[0in][r]{\LogSectionBulletFormat{\theLogSectioni.}\hspace{\StandardLabelSep}}%
	#1\textnormal{ --- }%
}
\newlist{LogSection}{description}{3}
\setlist[LogSection,1]{%
	labelsep=0in,%
	style=standard,%
	format=\LogSectionFormat,%
	before=\setcounter{LogSectioni}{0}%
}

\newlengthval{\SmokeyListingAboveSkip}{1.5\parskip}
\newlengthval{\SmokeyListingBelowSkip}{-\medskipamount}
\addtolength{\SmokeyListingBelowSkip}{1.5\parskip}

\newlengthval{\SmokeyTableParskipTop}{0.75\parskip}
\newlengthval{\SmokeyTableParskipBottom}{\parskip}

\usepackage{mylistings/listings}
\lstset{%
	frame=none,%
	keepspaces=true,%
	basicstyle=\footnotesize\ttfamily,%
	tabsize=4,%
	linewidth=4in,%
	minipagewidth=\textwidth,%
	aboveskip=\SmokeyListingAboveSkip,%
	belowskip=\SmokeyListingBelowSkip,%
}
\lstdefinestyle{LuaCodeStyle}{%
	% Why does \color{SmokeyBlue} not work?
	%backgroundcolor=\color{SmokeyBlue},%
	frame=single,
	rulecolor=\color[RGB]{252,251,220},%
	backgroundcolor=\color[RGB]{252,251,220},%
	linewidth=4in,%
	xleftmargin=\leftmargini%
}
\lstdefinestyle{SmokeyApiStyle}{%
	linewidth=4in,%
	xleftmargin=\leftmargini%
}
\lstdefinestyle{SettingStyle}{%
	linewidth=4in,%
	xleftmargin=\leftmargini%
}
\lstdefinestyle{TerminalOutputStyle}{%
	linewidth=4in,%
	xleftmargin=\leftmargini%
}
\lstdefinestyle{LogExcerptStyle}{%
	frame=single,%
	rulecolor=\color{SmokeyDarkBlue},%
	linewidth=\textwidth%
}
\lstdefinestyle{AnnotedLogFileStyle}{%
	frame=single,%
	rulecolor=\color{SmokeyDarkBlue},%
	linewidth=\textwidth,%
	basicstyle=\scriptsize\ttfamily,%
	xleftmargin=78pt,%
	tabsize=8,%
	breaklines=true,%
	breakatwhitespace=true,%
	breakindent=0in,%
	breakautoindent=false,%
	prebreak=\raisebox{-1ex}[0in][0in]{$\hookleftarrow$},%
	%postbreak=\raisebox{1ex}[0in][0in]{$\hookrightarrow\;$},%
}
\lstdefinestyle{CommandLineStyle}{%
	linewidth=4in%
}

\lstnewenvironment{LuaCode}[1][]%
	{%
		\lstset{style=LuaCodeStyle,#1,minipage}%
	}%
	{}
\lstnewenvironment{LuaApi}[1][]%
	{%
		\lstset{%
			style=SmokeyApiStyle,%
			escapechar=~,%
			#1,%
			inject=\raisebox{-0.125ex}[0in][0in]{\makebox[0in][r]{\makebox[\leftmargini][c]{\Large\ComputerMouse}}},%
			xleftmargin=\leftmargini,%
		}%
	}%
	{}
\lstnewenvironment{Setting}%
	{%
		\lstset{style=SettingStyle,escapechar=~}%
	}%
	{}
\lstnewenvironment{TerminalOutput}%
	{%
		\lstset{%
			style=TerminalOutputStyle,%
			escapechar=~,%
			inject=\raisebox{-0.125ex}[0in][0in]{\makebox[0in][r]{\makebox[\leftmargini][c]{\Large\Printer}}},%
			xleftmargin=\leftmargini,%
		}%
	}%
	{}
\newlength{\ElideShift}
\lstnewenvironment{LogExcerpt}%
	{%
		\lstset{style=LogExcerptStyle,escapechar=~}%
		\newcommand{\elide}{%
			\makebox[0in][l]{%
				% Align past the listing frame (based on framesep length)
				\setlength{\ElideShift}{-5.2pt}%
				\addtolength{\ElideShift}{-2em}%
				\hspace{\ElideShift}%
				\begin{tikzpicture}[%
					every path/.style={%
						decoration={%
							complete sines,%
							segment length=2em,%
							amplitude=0.5ex%
						},%
						decorate%
					}%
				]%
					% Knock-out color
					\draw[color=white, yshift=0.475ex, line width=0.575ex] (-2em-0.5pt,0) -- (\linewidth+6.7pt+2em,0);%
					% Match frame color
					\draw[color=SmokeyDarkBlue, yshift=0.85ex] (0,0) -- (\linewidth+6.7pt,0);%
					\draw[color=SmokeyDarkBlue, yshift=0.15ex] (0,0) -- (\linewidth+6.7pt,0);%
				\end{tikzpicture}%
			}%
		}%
	}%
	{}
\lstnewenvironment{AnnotedLogFile}%
	{%
		\lstset{style=AnnotedLogFileStyle,escapechar=~}%
		% Custom \marginpar-like command
		\renewcommand{\mp}[1]{%
			\makebox[0in][r]{%
				\color{SmokeyDarkBlue}%
				\raisebox{0in}[0in][0in]{%
					\fbox{%
						\normalfont\bfseries\scriptsize##1%
					}%
				}%
				\rule[0.5ex]{1em}{\fboxrule}%
				\hspace{3pt}%
			}%
		}%
	}%
	{}
\lstnewenvironment{CommandLine}%
	{%
		\lstset{%
			style=CommandLineStyle,%
			escapechar=~,%
			inject=\raisebox{-0.125ex}[0in][0in]{\makebox[0in][r]{\makebox[\leftmargini][c]{\Large\Keyboard}}},%
			% Why does the linewidth seem to change when xleftmargin is set?
			linewidth=4.25in,%
			xleftmargin=\leftmargini%
		}%
	}%
	{}

\usepackage{colortbl}
\usepackage{tabu}
\usepackage{multirow}

\usepackage{array}
\renewcommand{\arraystretch}{1.5}

\newenvironment{PropertyTable}%
	{%
		\vspace{\SmokeyTableParskipTop}%
		\small%
		\begin{tabu}{| >{\columncolor{SmokeyLightBlue}}m{1.5in} m{1in} m{1in} |}%
			\rowfont{\color{white}\cellcolor{SmokeyBlue}}%
			\taburulecolor{SmokeyBlue}%
			\hline%
	}%
	{%
			\hline%
		\end{tabu}%
		\vspace{\SmokeyTableParskipBottom}%
	}

\newenvironment{ArgumentTable}%
	{%
		\vspace{\SmokeyTableParskipTop}%
		\small%
		\begin{tabu}{| >{\columncolor{SmokeyLightBlue}}m{1.2in} m{3in} |}%
			\rowfont{\color{white}\cellcolor{SmokeyBlue}}%
			\taburulecolor{SmokeyBlue}%
			\hline%
	}%
	{%
			\hline%
		\end{tabu}%
		\vspace{\SmokeyTableParskipBottom}%
	}

\newenvironment{PropertyTableContains}%
	{%
		\vspace{\SmokeyTableParskipTop}%
		\small%
		\begin{tabu}{| >{\columncolor{SmokeyLightBlue}}m{1.5in} m{0.8in} m{2in} m{0.6in} |}%
			\rowfont{\color{white}\cellcolor{SmokeyBlue}}%
			\taburulecolor{SmokeyBlue}%
			\hline%
	}%
	{%
			\hline%
		\end{tabu}%
		\vspace{\SmokeyTableParskipBottom}%
	}

\newenvironment{ValueTable}%
	{%
		\vspace{\SmokeyTableParskipTop}%
		\small%
		\begin{tabu}{| >{\columncolor{SmokeyLightBlue}}m{1.25in} m{1in} |}%
			\rowfont{\color{white}\cellcolor{SmokeyBlue}}%
			\taburulecolor{SmokeyBlue}%
			\hline%
	}%
	{%
			\hline%
		\end{tabu}%
		\vspace{\SmokeyTableParskipBottom}%
	}

\newenvironment{PdcaTable}%
	{%
		\vspace{\SmokeyTableParskipTop}%
		\small%
		\newcommand{\mc}[2]{\multicolumn{##1}{c|}{##2}}%
		\begin{tabu}{| >{\columncolor{SmokeyLightBlue}}m{1.5in} | >{\centering}m{1in} | >{\centering}m{1in} | >{\centering}m{1in} |}%
			\rowfont{\color{white}\cellcolor{SmokeyBlue}}%
			\taburulecolor{SmokeyBlue}%
			\everyrow{\hline}%
			\hline%
	}%
	{%
			\hline%
		\end{tabu}%
		\vspace{\SmokeyTableParskipBottom}%
	}

\newenvironment{StatusScreenTable}%
	{%
		\vspace{\SmokeyTableParskipTop}%
		\small%
		\begin{tabu}{| >{\centering}m{0.22\textwidth} >{\centering}m{0.22\textwidth} >{\centering}m{0.22\textwidth} >{\centering}m{0.22\textwidth} |}%
			\rowfont{\color{white}\cellcolor{SmokeyBlue}}%
			\taburulecolor{SmokeyBlue}%
			\hline%
	}%
	{%
			\hline%
		\end{tabu}%
		\vspace{\SmokeyTableParskipBottom}%
	}

\newenvironment{ApiTable}%
	{%
		\vspace{\SmokeyTableParskipTop}%
		\small%
		\begin{tabu}{| >{\columncolor{SmokeyLightBlue}}m{1in} m{0.5in} m{0.5in} m{2.75in} |}%
			\rowfont{\color{white}\cellcolor{SmokeyBlue}}%
			\taburulecolor{SmokeyBlue}%
			\hline%
	}%
	{%
			\hline%
		\end{tabu}%
		\vspace{\SmokeyTableParskipBottom}%
	}

\newenvironment{LuaStruct}%
	{%
		\vspace{\SmokeyTableParskipTop}%
		\small%
		\begin{tabu}{| >{\columncolor{SmokeyLightBlue}}m{1in} m{0.5in} m{3.5in} |}%
			\rowfont{\color{white}\cellcolor{SmokeyBlue}}%
			\taburulecolor{SmokeyBlue}%
			\hline%
	}%
	{%
			\hline%
		\end{tabu}%
		\vspace{\SmokeyTableParskipBottom}%
	}

\newenvironment{DirectoryTree}%
	{%
		% These commands are a wrapper around the TikZ notation in order
		% to automatically add decorations around certain node labels.
		%
		%     \node {foo} 
		%         child { node {bar}
		%             child { node {baz} }
		%             }
		%         child { node {boo}
		%             child { node {bah} }
		%             }
		%         ;
		%
		% There's a lot of \expandafter because we need to expand
		% *EVERYTHING* at the top level before handing parsing control
		% over to TikZ, which does not do LaTeX expansion.
		%
		% Also, it appears that nesting \def or \edef inside another
		% \def or \edef just doesn't work, so \Root has a different
		% implementation style than \File or \Directory.
		\newcommand{\DiskRoot}[2]{%
			\edef\RootLabel{##1}%
			\edef\RootChild{##2}%
			\expandafter\expandafter%
			\expandafter\node%
			\expandafter\expandafter%
			\expandafter{%
				\expandafter\expandafter%
				\expandafter\FloppySym%
				\expandafter\expandafter%
				\expandafter{%
				\expandafter\expandafter%
				\expandafter}%
				\expandafter\expandafter%
				\expandafter\ %
				\expandafter\RootLabel%
			\expandafter}%
			\RootChild%
			;%
		}%
		\newcommand{\Root}[2]{%
			\edef\RootLabel{##1}%
			\edef\RootChild{##2}%
			\expandafter\expandafter%
			\expandafter\node%
			\expandafter\expandafter%
			\expandafter{%
				\expandafter\expandafter%
				\expandafter\OpenFolderSym%
				\expandafter\expandafter%
				\expandafter{%
				\expandafter\expandafter%
				\expandafter}%
				\expandafter\expandafter%
				\expandafter\ %
				\expandafter\RootLabel%
			\expandafter}%
			\RootChild%
			;%
		}%
		\newcommand{\File}[1]{child{node{##1}}}
		\newcommand{\ClosedDirectory}[1]{%
			\expandafter child%
			\expandafter{%
				\expandafter node%
				\expandafter{%
					\expandafter\noexpand%
					\expandafter\ClosedFolderSym%
					\expandafter{%
					\expandafter}%
					\expandafter\ %
					##1%
				}%
			}%
		}%
		\newcommand{\Directory}[2]{%
			\expandafter child%
			\expandafter{%
				\expandafter node%
					\expandafter{%
						\expandafter\noexpand%
						\expandafter\OpenFolderSym%
						\expandafter{%
						\expandafter}%
						\expandafter\ %
						\expandafter##1%
					\expandafter}%
				##2%
			}%
		}%
		%\hspace{\leftmargini}
		\small%
		\begin{center}%
		\begin{tikzpicture}[dirtree]%
	}%
	{%
		\end{tikzpicture}%
		\end{center}%
	}

\newlength{\SideBySideTopSep}
\newcommand{\SideBySideDirectories}[2]{%
	% Emulate the {center} environment's list-style formatting
	\setlength{\SideBySideTopSep}{\topsep}%
	\addtolength{\SideBySideTopSep}{\parskip}%
	% The following \raisebox calls place all content below the baseline,
	% so compensate by pulling them up one line
	\addtolength{\SideBySideTopSep}{-\baselineskip}%
	\vspace{\SideBySideTopSep}%
	\hfill%
	\makebox[0in][c]{%
		\raisebox{-\height}{%
		\begin{minipage}{0.5\linewidth}%
		#1%
		\end{minipage}%
		}%
	}%
	\hfill%
	\makebox[0in][c]{%
		\raisebox{-\height}{%
		\begin{minipage}{0.5\linewidth}%
		#2%
		\end{minipage}%
		}%
	}%
	\hfill\null\newline%
	% More {center} emulation
	\vspace{\topsep}%
}

\usepackage{graphicx}
\usepackage{twoopt}

\newlengthval{\CenterImageVerticalMargin}{1ex plus 2ex minus 1ex}
\newcommandtwoopt{\CenterImage}[3][\linewidth][\CenterImageVerticalMargin]{%
	\begin{centering}%
		\vspace{#2}%
		\includegraphics[width=#1]{#3}%
		\vspace{#2}%
	\end{centering}%
}

\usepackage{ifthen}
\makeatletter
\newcommand{\iftt}[1]{\ifthenelse{\equal{\f@family}{\ttdefault}}{#1}{}}
\makeatother

\usepackage{xstring}
\usepackage{verbatim}

% Sequence properties
\newcommand{\prop}[1]{{\itshape#1}}
\newcommand{\propval}[1]{{\itshape#1}}
% Library functions
\newcommand{\func}[1]{\mbox{\itshape#1}}
% NVRAM variables, Control bits
\newcommand{\nvram}[1]{\mbox{\itshape#1}}
\newcommand{\nvarg}[1]{\mbox{``#1''}}
% Jargon (Smokey terminology)
\newcommand{\jargon}[1]{{\bfseries#1}}
% User-specified values (including command line arguments)
\newcommand{\param}[1]{{\iftt{\bfseries}\itshape#1}}
% Language keywords or in-line code
\newcommand{\keyword}[1]{\mbox{\itshape#1}}
% Command line programs and their prameters (excluding Mac OS X GUI apps)
\newcommand{\cmdline}[1]{%
	\mbox{%
		\itshape%
		\StrSubstitute%
			{#1}%
			{--}%
			{{-}{-}}%
	}%
}
% File names
\newcommand{\filename}[1]{``#1''}
\newcommand{\dirname}[1]{{\itshape#1}}

\newcommand{\optional}{\textit{(optional)}}

\hyphenation{Number-Of-Times-To-Run}
\hyphenation{Factory-Logs-Waiting-To-Be-Collected}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\newgeometry{top=\TopMargin, bottom=\BottomMargin, hmargin=\TransverseMargin}

\include{LHAManualTitle}

\clearpage
\fancyhfoffset[r]{0in}
\pagenumbering{gobble}

\setcounter{tocdepth}{3}
\tableofcontents

\clearpage
\fancyhfoffset[l]{\BodyIndentLeft}
\fancyhfoffset[r]{0in}
% TODO: Why does using \restoregeometry instead of \newgeometry cause the
% following pages to shift downards?
%\restoregeometry
\newgeometry{top=\TopMargin, bottom=\BottomMargin, left=\LeftMargin, right=\TransverseMargin}
\pagenumbering{arabic}

\include{LHAManualBody}

\end{document}
